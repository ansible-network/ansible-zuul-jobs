##
# `ansible-test sanity`
# Single job tests multiple Python versions
#
- job:
    name: ansible-test-sanity
    description: ansible-test sanity
    run: playbooks/ansible-test-sanity/run.yaml
    required-projects:
      # Needed for access to ansible-test
      - name: ansible/ansible
        override-checkout: devel
    nodeset:
      nodes:
        # We need a container with various Python versions available
        name: container
        label: f27-oci

##
# ansible-role-tests
#   ansible:stable py2 & py3
#   ansible:devel  py2
#

- job: # REMOVE THIS once live
    name: ansible-role-tests
    description: ansible-role tests against Stable Ansible with Python 2
    run: playbooks/ansible-role-tests/run.yaml
    required-projects:
      - name: ansible-network/network-engine-zuul
        override-checkout: devel
    vars:
      pip: pip2
    nodeset:
      nodes:
        # We need a container with various Python versions available
        name: container
        label: f27-oci
- job:
    name: ansible-role-tests-base
    description: |
      Parent job for ``ansible role`` tests for testing against different
      Ansible and Python versions

      Responds to these variables:

      .. zuul:jobvar:: pip

         Name of pip binary to use to install dependencies to allow testing
         against different Python versions.

         Example ``pip2`` or ``pip3``

      .. zuul:jobvar:: ansible_pip_package

         Provides the ability to pip install different versions of Ansible

         Example ``ansible`` or ``"git+https://github.com/ansible/ansible.git@devel"``

    run: playbooks/ansible-role-tests/run.yaml
    required-projects:
      - name: ansible-network/network-engine-zuul
        override-checkout: devel
    nodeset:
      nodes:
        # We need a container with various Python versions available
        name: container
        label: f27-oci

- job:
    name: ansible-role-tests-stable-py2
    description: ansible-role tests against stable Ansible with Python 2
    parent: ansible-role-tests-base
    vars:
      pip: pip2
      ansible_pip_package: ansible

- job:
    name: ansible-role-tests-stable-py3
    description: ansible-role tests against stable Ansible with Python 3
    parent: ansible-role-tests-base
    vars:
      pip: pip3
      ansible_pip_package: ansible

- job:
    name: ansible-role-tests-devel-py2
    description: ansible-role tests against devel Ansible with Python 2
    parent: ansible-role-tests-base
    vars:
      pip: pip2
      ansible_pip_package: "git+https://github.com/ansible/ansible.git@devel"

##
# ansible-test-network-integration
#   Will move to ansible/ansible soon
#   Just here for testing with sf-webhook till sf-webhook is enabled on ansible/ansible
#

- job:
    name: ansible-test-network-integration
    description: |
       Parent job for ``ansible-test network-integration`` tests.

       Responds to these variables:

       .. zuul:jobvar:: python_version

          Instruct ansible-test to test against this version of Python.

          Example ``2.6``, ``2.7``, ``3.5``, ``3.6``

       .. zuul:jobvar:: platform

          Network platform to test against, such as ``eos``, ``ios``, ``vyos``
    run: playbooks/ansible-test-network-integration/run.yaml
    # use debug from ansible-network/zuul-config#18
    parent: base-test
    required-projects:
      # FIXME When this zuul job is moved to ansible/ansible this will be removed as context will be the given PR
      - name: ansible/ansible
        override-checkout: devel

- job:
    name: ansible-test-network-integration-vyos-devel-py2
    description: ansible-test network-integration on Python 2
    parent: ansible-test-network-integration
    vars:
      platform: vyos
      python_version: 2.7
    nodeset:
      nodes:
        - name: test-node
          label: ansible-network-vyos-1.1.8

- job:
    name: ansible-test-network-integration-vyos-devel-py3
    description: ansible-test network-integration on Python 3
    parent: ansible-test-network-integration
    vars:
      platform: vyos
      python_version: 3.6
    nodeset:
      nodes:
        - name: test-node
          label: ansible-network-vyos-1.1.8
